(function(d){"function"===typeof define&&define.amd?define(["jquery","./grid.base"],d):"object"===typeof exports?d(require("jquery")):d(jQuery)})(function(d){var y=d.jgrid,w=d.fn.jqGrid;y.extend({groupingSetup:function(){return this.each(function(){var b,p;p=this.p;var e=p.colModel,a=p.groupingView,c,k,f=function(){return""};if(null===a||"object"!==typeof a&&!d.isFunction(a))p.grouping=!1;else if(a.groupField.length){void 0===a.visibiltyOnNextGrouping&&(a.visibiltyOnNextGrouping=[]);a.lastvalues=
[];a._locgr||(a.groups=[]);a.counters=[];for(b=0;b<a.groupField.length;b++)a.groupOrder[b]||(a.groupOrder[b]="asc"),a.groupText[b]||(a.groupText[b]="{0}"),"boolean"!==typeof a.groupColumnShow[b]&&(a.groupColumnShow[b]=!0),"boolean"!==typeof a.groupSummary[b]&&(a.groupSummary[b]=!1),a.groupSummaryPos[b]||(a.groupSummaryPos[b]="footer"),c=e[p.iColByName[a.groupField[b]]],!0===a.groupColumnShow[b]?(a.visibiltyOnNextGrouping[b]=!0,null!=c&&!0===c.hidden&&w.showCol.call(d(this),a.groupField[b])):(a.visibiltyOnNextGrouping[b]=
d("#"+y.jqID(p.id+"_"+a.groupField[b])).is(":visible"),null!=c&&!0!==c.hidden&&w.hideCol.call(d(this),a.groupField[b]));a.summary=[];a.hideFirstGroupCol&&(a.formatDisplayField[0]=function(a){return a});b=0;for(p=e.length;b<p;b++)c=e[b],a.hideFirstGroupCol&&!c.hidden&&a.groupField[0]===c.name&&(c.formatter=f),c.summaryType&&(k={nm:c.name,st:c.summaryType,v:"",sr:c.summaryRound,srt:c.summaryRoundType||"round"},c.summaryDivider&&(k.sd=c.summaryDivider,k.vd=""),a.summary.push(k))}else p.grouping=!1})},
groupingPrepare:function(b,p){this.each(function(){var e=this.p.groupingView,a=e.groups,c=e.counters,k=e.lastvalues,f=e.isInTheSameGroup,r=e.groupField.length,q,l,u,v,g,h,y=!1,B=w.groupingCalculations.handler;for(q=0;q<r;q++)if(v=e.groupField[q],l=e.displayField[q],g=b[v],h=null==l?null:b[l],null==h&&(h=g),void 0!==g){u=[];for(l=0;l<=q;l++)u.push(b[e.groupField[l]]);v={idx:q,dataIndex:v,value:g,displayValue:h,startRow:p,cnt:1,keys:u,summary:[]};0===p?(a.push(v),k[q]=g,l={cnt:1,pos:a.length-1,summary:d.extend(!0,
[],e.summary)},c[q]=l):(l={cnt:1,pos:a.length,summary:d.extend(!0,[],e.summary)},"object"===typeof g||(d.isArray(f)&&d.isFunction(f[q])?f[q].call(this,k[q],g,q,e):k[q]===g)?y?(a.push(v),k[q]=g,c[q]=l):(l=c[q],l.cnt+=1,a[l.pos].cnt=l.cnt):(a.push(v),k[q]=g,y=!0,c[q]=l));g=a[l.pos];var x;for(u=0;u<l.summary.length;u++)h=l.summary[u],x=d.isArray(h.st)?h.st[v.idx]:h.st,d.isFunction(x)?h.v=x.call(this,h.v,h.nm,b,v):(h.v=B.call(d(this),x,h.v,h.nm,h.sr,h.srt,b),"avg"===x.toLowerCase()&&h.sd&&(h.vd=B.call(d(this),
x,h.vd,h.sd,h.sr,h.srt,b)));g.summary=l.summary}});return this},groupingToggle:function(b,p){this.each(function(){var e=this.p,a=e.groupingView,c=a.minusicon,k=a.plusicon,f=p?d(p).closest("tr.jqgroup"):d("#"+y.jqID(b)),r,q,l=!0,u=!1,v=[],g=function(a){var b,c=a.length;for(b=0;b<c;b++)v.push(a[b])},h=parseInt(f.data("jqgrouplevel"),10);e.frozenColumns&&0<f.length&&(q=f[0].rowIndex,f=d(this.rows[q]),f=f.add(this.grid.fbRows[q]));r=f.find(">td>span.tree-wrap");y.hasAllClasses(r,c)?(r.removeClass(c).addClass(k),
u=!0):r.removeClass(k).addClass(c);for(f=f.next();f.length;f=f.next())if(f.hasClass("jqfoot"))if(r=parseInt(f.data("jqfootlevel"),10),u){if(r=parseInt(f.data("jqfootlevel"),10),(!a.showSummaryOnHide&&r===h||r>h)&&g(f),r<h)break}else{if((r===h||a.showSummaryOnHide&&r===h+1)&&g(f),r<=h)break}else if(f.hasClass("jqgroup"))if(r=parseInt(f.data("jqgrouplevel"),10),u){if(r<=h)break;g(f)}else{if(r<=h)break;r===h+1&&(f.find(">td>span.tree-wrap").removeClass(c).addClass(k),g(f));l=!1}else(u||l)&&g(f);d(v).css("display",
u?"none":"");e.frozenColumns&&d(this).triggerHandler("jqGridResetFrozenHeights",[{header:{resizeDiv:!1,resizedRows:{iRowStart:-1,iRowEnd:-1}},resizeFooter:!1,body:{resizeDiv:!0,resizedRows:{iRowStart:q,iRowEnd:f.length?f[0].rowIndex-1:-1}}}]);this.fixScrollOffsetAndhBoxPadding();d(this).triggerHandler("jqGridGroupingClickGroup",[b,u]);d.isFunction(e.onClickGroup)&&e.onClickGroup.call(this,b,u)});return!1},groupingRender:function(b,p){function e(a,b,e,f,p){var h=x[a],n,q="",l,t,r,u=0,v,w,B,F=!0;if(0!==
b&&0!==x[a].idx)for(n=a;0<=n;n--)if(x[n].idx===x[a].idx-b){h=x[n];break}a=h.cnt;for(v=void 0===p?f:0;v<H;v++){b="&#160;";n=z[v];for(l=0;l<h.summary.length;l++)if(t=h.summary[l],w=d.isArray(t.st)?t.st[e.idx]:t.st,B=d.isArray(n.summaryTpl)?n.summaryTpl[e.idx]:n.summaryTpl||"{0}",t.nm===n.name){"string"===typeof w&&"avg"===w.toLowerCase()&&(t.sd&&t.vd?t.v/=t.vd:t.v&&0<a&&(t.v/=a));try{t.groupCount=h.cnt,t.groupIndex=h.dataIndex,t.groupValue=h.value,r=c.formatter("",t.v,v,t)}catch(G){r=t.v}b=y.format(B,
r);n.summaryFormat&&(b=n.summaryFormat.call(c,e,b,r,n,t));break}t=l=!1;void 0!==p&&F&&!n.hidden&&(b=p,F=!1,1<f&&(l=!0,u=f-1),t=n.align,n.align="rtl"===k.direction?"right":"left",g.iconColumnName=n.name);0<u&&!n.hidden&&"&#160;"===b?(t&&(n.align=t),u--):(q+="<td role='gridcell' "+c.formatCol(v,1,"")+(l?"colspan='"+f+"'":"")+">"+b+"</td>",t&&(n.align=t))}return q}var a="",c=this[0],k=c.p,f=0,r,q=[],l="",u,v,g=k.groupingView,h=d.makeArray(g.groupSummary),G=(g.groupCollapse?g.plusicon:g.minusicon)+" tree-wrap",
B=g.groupField.length,x=g.groups,z=k.colModel,H=z.length,F=k.page,I=w.getGuiStyles.call(c,"gridRow","jqgroup ui-row-"+k.direction),J=w.getGuiStyles.call(c,"gridRow","jqfoot ui-row-"+k.direction);d.each(z,function(a,b){var c;for(c=0;c<B;c++)if(g.groupField[c]===b.name){q[c]=a;break}});h.reverse();d.each(x,function(w,m){if(g._locgr&&!(m.startRow+m.cnt>(F-1)*p&&m.startRow<F*p))return!0;f++;v=k.id+"ghead_"+m.idx;u=v+"_"+w;l="<span style='cursor:pointer;margin-"+("rtl"===k.direction?"right:":"left:")+
12*m.idx+"px;' class='"+g.commonIconClass+" "+G+"' onclick=\"jQuery('#"+y.jqID(k.id).replace("\\","\\\\")+"').jqGrid('groupingToggle','"+u+"', this);return false;\"></span>";try{d.isArray(g.formatDisplayField)&&d.isFunction(g.formatDisplayField[m.idx])?(m.displayValue=g.formatDisplayField[m.idx].call(c,m.displayValue,m.value,z[q[m.idx]],m.idx,g),r=m.displayValue):r=c.formatter(u,m.displayValue,q[m.idx],m.value)}catch(K){r=m.displayValue}a+="<tr id='"+u+"' data-jqgrouplevel='"+m.idx+"' "+(g.groupCollapse&&
0<m.idx?"style='display:none;' ":"")+"role='row' class='"+I+" "+v+"'>";var A=d.isFunction(g.groupText[m.idx])?g.groupText[m.idx].call(c,r,m.cnt,m.summary):y.template(g.groupText[m.idx],r,m.cnt,m.summary),D,E,C,n;n=0;C=B-1===m.idx;"string"!==typeof A&&"number"!==typeof A&&(A=r);"header"===g.groupSummaryPos[m.idx]?(D=1,"cb"!==z[0].name&&"cb"!==z[1].name||D++,"subgrid"!==z[0].name&&"subgrid"!==z[1].name||D++,a+=e(w,0,m,D,l+"<span class='cell-wrapper'>"+A+"</span>")):a+="<td role='gridcell' style='padding-left:"+
12*m.idx+"px;' colspan='"+H+"'>"+l+A+"</td>";a+="</tr>";if(C){A=x[w+1];C=m.startRow;D=void 0!==A?A.startRow:x[w].startRow+x[w].cnt;g._locgr&&(n=(F-1)*p,n>m.startRow&&(C=n));for(;C<D&&b[C-n];C++)a+=b[C-n].join("");if("header"!==g.groupSummaryPos[m.idx]){if(void 0!==A){for(E=0;E<g.groupField.length&&A.dataIndex!==g.groupField[E];E++);f=g.groupField.length-E}for(n=0;n<f;n++)h[n]&&(a+="<tr data-jqfootlevel='"+(m.idx-n)+(g.groupCollapse&&(0<m.idx-n||!g.showSummaryOnHide)?"' style='display:none;'":"'")+
" role='row' class='"+J+"'>",a+=e(w,n,x[m.idx-n],0),a+="</tr>");f=E}}});this.unbind("jqGridShowHideCol.groupingRender").bind("jqGridShowHideCol.groupingRender",function(){var a=k.iColByName[g.iconColumnName],b,e,f;if(0<=d.inArray("header",g.groupSummaryPos)){for(b=0;b<z.length;b++)if(!z[b].hidden){f=b;break}if(void 0!==f&&a!==f){for(b=0;b<c.rows.length;b++)e=c.rows[b],d(e).hasClass("jqgroup")&&(d(e.cells[f]).html(e.cells[a].innerHTML),d(e.cells[a]).html("&nbsp;"));g.iconColumnName=z[f].name}}});return a},
groupingGroupBy:function(b,p){return this.each(function(){var e=this.p,a=e.groupingView,c,k;"string"===typeof b&&(b=[b]);e.grouping=!0;a._locgr=!1;void 0===a.visibiltyOnNextGrouping&&(a.visibiltyOnNextGrouping=[]);for(c=0;c<a.groupField.length;c++)k=e.colModel[e.iColByName[a.groupField[c]]],!a.groupColumnShow[c]&&a.visibiltyOnNextGrouping[c]&&null!=k&&!0===k.hidden&&w.showCol.call(d(this),a.groupField[c]);for(c=0;c<b.length;c++)a.visibiltyOnNextGrouping[c]=d(e.idSel+"_"+y.jqID(b[c])).is(":visible");
e.groupingView=d.extend(e.groupingView,p||{});a.groupField=b;d(this).trigger("reloadGrid")})},groupingRemove:function(b){return this.each(function(){var p=this.p,e=this.tBodies[0],a=p.groupingView;void 0===b&&(b=!0);p.grouping=!1;if(!0===b){for(p=0;p<a.groupField.length;p++)!a.groupColumnShow[p]&&a.visibiltyOnNextGrouping[p]&&w.showCol.call(d(this),a.groupField);d("tr.jqgroup, tr.jqfoot",e).remove();d("tr.jqgrow",e).filter(":hidden").show()}else d(this).trigger("reloadGrid")})},groupingCalculations:{handler:function(b,
d,e,a,c,k){var f={sum:function(){return parseFloat(d||0)+parseFloat(k[e]||0)},min:function(){return""===d?parseFloat(k[e]||0):Math.min(parseFloat(d),parseFloat(k[e]||0))},max:function(){return""===d?parseFloat(k[e]||0):Math.max(parseFloat(d),parseFloat(k[e]||0))},count:function(){""===d&&(d=0);return k.hasOwnProperty(e)?d+1:0},avg:function(){return f.sum()}};if(!f[b])throw"jqGrid Grouping No such method: "+b;b=f[b]();null!=a&&("fixed"===c?b=b.toFixed(a):(a=Math.pow(10,a),b=Math.round(b*a)/a));return b}}})});
//# sourceMappingURL=grid.grouping.map
