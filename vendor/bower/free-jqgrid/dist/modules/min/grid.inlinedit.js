(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var k=c.jgrid,F=k.fullBoolFeedback,A=k.hasOneFromClasses,N=c.fn.jqGrid,I=function(c){return N.getGuiStyles.call(this,"states."+c)},J=function(d){var p=c.makeArray(arguments).slice(1);p.unshift("");p.unshift("Inline");p.unshift(d);return k.feedback.apply(this,p)};k.inlineEdit=k.inlineEdit||{};k.extend({editRow:function(d,
p,l,f,b,g,t,v,h,a){var e={},m=c.makeArray(arguments).slice(1);"object"===c.type(m[0])?e=m[0]:(void 0!==p&&(e.keys=p),c.isFunction(l)&&(e.oneditfunc=l),c.isFunction(f)&&(e.successfunc=f),void 0!==b&&(e.url=b),null!=g&&(e.extraparam=g),c.isFunction(t)&&(e.aftersavefunc=t),c.isFunction(v)&&(e.errorfunc=v),c.isFunction(h)&&(e.afterrestorefunc=h),c.isFunction(a)&&(e.beforeEditRow=a));return this.each(function(){var a=this,b=c(a),f=a.p,g=0,r=null,p={},l=f.colModel,h=f.prmNames;if(a.grid){var m=c.extend(!0,
{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeEditRow:null,mtype:"POST",focusField:!0},k.inlineEdit,f.inlineEditing||{},e),q=b.jqGrid("getInd",d,!0),t=m.focusField,v="object"===typeof t&&null!=t?c(t.target||t).closest("tr.jqgrow>td")[0]:null;if(!1!==q&&(m.extraparam[h.oper]===h.addoper||J.call(a,m,"beforeEditRow",m,d))&&"0"===(c(q).attr("editable")||"0")&&!c(q).hasClass("not-editable-row")){h=k.detectRowEditing.call(a,
d);if(null!=h&&"cellEditing"===h.mode){var h=h.savedRow,G=a.rows[h.id],H=I.call(a,"select");b.jqGrid("restoreCell",h.id,h.ic);c(G.cells[h.ic]).removeClass("edit-cell "+H);c(G).addClass(H).attr({"aria-selected":"true",tabindex:"0"})}k.enumEditableCells.call(a,q,c(q).hasClass("jqgrid-new-row")?"add":"edit",function(b){var e=b.cm,h=c(b.dataElement),l=b.dataWidth,u,m=e.name,q=e.edittype,t=b.iCol,v=e.editoptions||{};if("hidden"!==b.editable){try{u=c.unformat.call(this,b.td,{rowId:d,colModel:e},t)}catch(K){u=
"textarea"===q?h.text():h.html()}p[m]=u;h.html("");e=c.extend({},v,{id:d+"_"+m,name:m,rowId:d,mode:b.mode,cm:e,iCol:t});if("&nbsp;"===u||"&#160;"===u||1===u.length&&160===u.charCodeAt(0))u="";u=k.createEl.call(a,q,e,u,!0,c.extend({},k.ajaxOptions,f.ajaxSelectOptions||{}));c(u).addClass("editable");h.append(u);l&&c(u).width(b.dataWidth);k.bindEv.call(a,u,e);"select"===q&&!0===v.multiple&&void 0===v.dataUrl&&k.msie&&c(u).width(c(u).width());null===r&&(r=t);g++}});0<g&&(p.id=d,f.savedRow.push(p),c(q).attr("editable",
"1"),t&&("number"===typeof t&&parseInt(t,10)<=l.length?r=t:"string"===typeof t?r=f.iColByName[t]:null!=v&&(r=v.cellIndex),setTimeout(function(){var d=b.jqGrid("getNumberOfFrozenColumns"),e=function(c){return f.frozenColumns&&0<d&&r<d?a.grid.fbRows[q.rowIndex].cells[c]:q.cells[c]},h=function(a){return c(a).find("input,textarea,select,button,object,*[tabindex]").filter(":input:visible:not(:disabled)")},k=function(){return h(f.frozenColumns&&0<d?a.grid.fbRows[q.rowIndex]:q).first()},u=h(e(r));0<u.length?
u.first().focus():"number"===typeof m.defaultFocusField||"string"===typeof m.defaultFocusField?(u=h(e("number"===typeof m.defaultFocusField?m.defaultFocusField:f.iColByName[m.defaultFocusField])),0===u.length&&(u=k()),u.first().focus()):k().focus()},0)),!0===m.keys&&(l=c(q),f.frozenColumns&&(l=l.add(a.grid.fbRows[q.rowIndex])),l.bind("keydown",function(a){if(27===a.keyCode)return b.jqGrid("restoreRow",d,m.afterrestorefunc),!1;if(13===a.keyCode){if("TEXTAREA"===a.target.tagName)return!0;b.jqGrid("saveRow",
d,m);return!1}})),F.call(a,m.oneditfunc,"jqGridInlineEditRow",d,m))}}})},saveRow:function(d,p,l,f,b,g,t,v){var h=c.makeArray(arguments).slice(1),a={},e=this[0],m=c(e),n=null!=e?e.p:null,K=k.info_dialog,x=c.isFunction,M=null!=k.defaults&&x(k.defaults.fatalError)?k.defaults.fatalError:alert;if(e.grid&&null!=n){"object"===c.type(h[0])?a=h[0]:(x(p)&&(a.successfunc=p),void 0!==l&&(a.url=l),void 0!==f&&(a.extraparam=f),x(b)&&(a.aftersavefunc=b),x(g)&&(a.errorfunc=g),x(t)&&(a.afterrestorefunc=t),x(v)&&(a.beforeSaveRow=
v));var h=function(a){return m.jqGrid("getGridRes",a)},a=c.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeSaveRow:null,ajaxSaveOptions:{},serializeSaveData:null,mtype:"POST",saveui:"enable",savetext:h("defaults.savetext")||"Saving..."},k.inlineEdit,n.inlineEditing||{},a),r={},A={},y={},z,D,q,C;q=m.jqGrid("getInd",d,!0);var B=c(q);z=n.prmNames;var G=h("errors.errcap"),H=h("edit.bClose"),L;if(!1!==q&&(h=a.extraparam[z.oper]===
z.addoper?"add":"edit",J.call(e,a,"beforeSaveRow",a,d,h)&&(z=B.attr("editable"),a.url=a.url||n.editurl,L="clientArray"!==a.url,"1"===z)))if(k.enumEditableCells.call(e,q,B.hasClass("jqgrid-new-row")?"add":"edit",function(a){var b=a.cm,n=b.formatter,h=b.editoptions||{},f=b.formatoptions||{},m={},l=(c.jgrid.detectRowEditing.call(e,d)||{}).savedRow,g=k.getEditedValue.call(e,c(a.dataElement),b,m,a.editable);"select"===b.edittype&&"select"!==b.formatter&&(A[b.name]=m.text);C=k.checkValues.call(e,g,a.iCol,
void 0,void 0,c.extend(a,{oldValue:null!=l?l[b.name]:null,newValue:g,oldRowData:l}));if(null!=C&&!1===C[0])return!1;"date"===n&&!0!==f.sendFormatted&&(g=c.unformat.date.call(e,g,b));L&&!0===h.NullIfEmpty&&""===g&&(g="null");r[b.name]=g}),null!=C&&!1===C[0])try{var E=m.jqGrid("getGridRowById",d),w=k.findPos(E);K.call(e,G,C[1],H,{left:w[0],top:w[1]+c(E).outerHeight()})}catch(O){M(C[1])}else if(E=d,z=n.prmNames,w=!1===n.keyName?z.id:n.keyName,r&&(r[z.oper]=z.editoper,void 0===r[w]||""===r[w]?r[w]=d:
q.id!==n.idPrefix+r[w]&&(q=k.stripPref(n.idPrefix,d),void 0!==n._index[q]&&(n._index[r[w]]=n._index[q],delete n._index[q]),d=n.idPrefix+r[w],B.attr("id",d),n.selrow===E&&(n.selrow=d),c.isArray(n.selarrrow)&&(q=c.inArray(E,n.selarrrow),0<=q&&(n.selarrrow[q]=d)),n.multiselect&&(q="jqg_"+n.id+"_"+d,B.find("input.cbox").attr("id",q).attr("name",q))),r=c.extend({},r,n.inlineData||{},a.extraparam)),L)m.jqGrid("progressBar",{method:"show",loadtype:a.saveui,htmlcontent:a.savetext}),y=c.extend({},r,y),y[w]=
k.stripPref(n.idPrefix,y[w]),n.autoEncodeOnEdit&&c.each(y,function(a,b){x(b)||(y[a]=k.oldEncodePostedData(b))}),c.ajax(c.extend({url:x(a.url)?a.url.call(e,y[w],h,y,a):a.url,data:k.serializeFeedback.call(e,x(a.serializeSaveData)?a.serializeSaveData:n.serializeRowData,"jqGridInlineSerializeSaveData",y),type:x(a.mtype)?a.mtype.call(e,h,a,y[w],y):a.mtype,complete:function(b,h){m.jqGrid("progressBar",{method:"hide",loadtype:a.saveui,htmlcontent:a.savetext});if((300>b.status||304===b.status)&&(0!==b.status||
4!==b.readyState)){var f,g;g=m.triggerHandler("jqGridInlineSuccessSaveRow",[b,d,a]);if(null==g||!0===g)g=[!0,r];g[0]&&x(a.successfunc)&&(g=a.successfunc.call(e,b));c.isArray(g)?(f=g[0],r=g[1]||r):f=g;if(!0===f){n.autoEncodeOnEdit&&c.each(r,function(a,b){r[a]=k.oldDecodePostedData(b)});r=c.extend({},r,A);m.jqGrid("setRowData",d,r);B.attr("editable","0");for(f=0;f<n.savedRow.length;f++)if(String(n.savedRow[f].id)===String(d)){D=f;break}0<=D&&n.savedRow.splice(D,1);F.call(e,a.aftersavefunc,"jqGridInlineAfterSaveRow",
d,b,r,a);B.removeClass("jqgrid-new-row").unbind("keydown")}else F.call(e,a.errorfunc,"jqGridInlineErrorSaveRow",d,b,h,null,a),!0===a.restoreAfterError&&m.jqGrid("restoreRow",d,a.afterrestorefunc)}},error:function(b,f,g){c("#lui_"+k.jqID(n.id)).hide();m.triggerHandler("jqGridInlineErrorSaveRow",[d,b,f,g,a]);if(x(a.errorfunc))a.errorfunc.call(e,d,b,f,g);else{b=b.responseText||b.statusText;try{K.call(e,G,'<div class="'+I.call(e,"error")+'">'+b+"</div>",H,{buttonalign:"right"})}catch(h){M(b)}}!0===a.restoreAfterError&&
m.jqGrid("restoreRow",d,a.afterrestorefunc)}},k.ajaxOptions,n.ajaxRowOptions,a.ajaxSaveOptions||{}));else{r=c.extend({},r,A);q=m.jqGrid("setRowData",d,r);B.attr("editable","0");for(h=0;h<n.savedRow.length;h++)if(String(n.savedRow[h].id)===String(E)){D=h;break}0<=D&&n.savedRow.splice(D,1);F.call(e,a.aftersavefunc,"jqGridInlineAfterSaveRow",d,q,r,a);B.removeClass("jqgrid-new-row").unbind("keydown")}}},restoreRow:function(d,p){var l=c.makeArray(arguments).slice(1),f={};"object"===c.type(l[0])?f=l[0]:
c.isFunction(p)&&(f.afterrestorefunc=p);return this.each(function(){var b=this,g=c(b),l=b.p,p=-1,h={},a;if(b.grid){var e=c.extend(!0,{},k.inlineEdit,l.inlineEditing||{},f),m=g.jqGrid("getInd",d,!0);if(!1!==m&&J.call(b,e,"beforeCancelRow",e,d)){for(a=0;a<l.savedRow.length;a++)if(String(l.savedRow[a].id)===String(d)){p=a;break}if(0<=p){if(c.isFunction(c.fn.datepicker))try{c("input.hasDatepicker","#"+k.jqID(m.id)).datepicker("hide")}catch(n){}c.each(l.colModel,function(){var a=this.name;l.savedRow[p].hasOwnProperty(a)&&
(h[a]=l.savedRow[p][a],!this.formatter||"date"!==this.formatter||null!=this.formatoptions&&!0===this.formatoptions.sendFormatted||(h[a]=c.unformat.date.call(b,h[a],this)))});g.jqGrid("setRowData",d,h);c(m).attr("editable","0").unbind("keydown");l.savedRow.splice(p,1);c("#"+k.jqID(d),b).hasClass("jqgrid-new-row")&&setTimeout(function(){g.jqGrid("delRowData",d);g.jqGrid("showAddEditButtons",!1)},0)}F.call(b,e.afterrestorefunc,"jqGridInlineAfterRestoreRow",d)}}})},addRow:function(d){return this.each(function(){if(this.grid){var p=
this,l=c(p),f=p.p,b=c.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,beforeAddRow:null,addRowParams:{extraparam:{}}},k.inlineEdit,f.inlineEditing||{},d||{});J.call(p,b,"beforeAddRow",b.addRowParams)&&(b.rowID=c.isFunction(b.rowID)?b.rowID.call(p,b):null!=b.rowID?b.rowID:k.randId(),!0===b.useDefValues&&c(f.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var d=this.editoptions.defaultValue;b.initdata[this.name]=c.isFunction(d)?d.call(p):
d}}),b.rowID=f.idPrefix+b.rowID,l.jqGrid("addRowData",b.rowID,b.initdata,b.position),c("#"+k.jqID(b.rowID),p).addClass("jqgrid-new-row"),b.useFormatter?c("#"+k.jqID(b.rowID)+" .ui-inline-edit",p).click():(f=f.prmNames,b.addRowParams.extraparam[f.oper]=f.addoper,l.jqGrid("editRow",b.rowID,b.addRowParams),l.jqGrid("setSelection",b.rowID)))}})},inlineNav:function(d,p){"object"===typeof d&&(p=d,d=void 0);return this.each(function(){var l=this,f=c(l),b=l.p;if(this.grid&&null!=b){var g,t=d===b.toppager?
b.idSel+"_top":b.idSel,v=d===b.toppager?b.id+"_top":b.id,h=I.call(l,"disabled"),a=c.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",commonIconClass:"ui-icon",iconsOverText:!1,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},f.jqGrid("getGridRes","nav"),k.nav||{},b.navOptions||{},k.inlineNav||{},b.inlineNavOptions||{},p||{});if(void 0===d)if(b.pager)if(f.jqGrid("inlineNav",
b.pager,a),b.toppager)d=b.toppager,t=b.idSel+"_top",v=b.id+"_top";else return;else b.toppager&&(d=b.toppager,t=b.idSel+"_top",v=b.id+"_top");if(void 0!==d&&(g=c(d),!(0>=g.length))){0>=g.find(".navtable").length&&f.jqGrid("navGrid",d,{add:!1,edit:!1,del:!1,search:!1,refresh:!1,view:!1});b._inlinenav=!0;if(!0===a.addParams.useFormatter){g=b.colModel;var e,m;for(e=0;e<g.length;e++)if(g[e].formatter&&"actions"===g[e].formatter){g[e].formatoptions&&(m={keys:!1,onEdit:null,onSuccess:null,afterSave:null,
onError:null,afterRestore:null,extraparam:{},url:null},g=c.extend(m,g[e].formatoptions),a.addParams.addRowParams={keys:g.keys,oneditfunc:g.onEdit,successfunc:g.onSuccess,url:g.url,extraparam:g.extraparam,aftersavefunc:g.afterSave,errorfunc:g.onError,afterrestorefunc:g.afterRestore});break}}a.add&&f.jqGrid("navButtonAdd",d,{caption:a.addtext,title:a.addtitle,commonIconClass:a.commonIconClass,buttonicon:a.addicon,iconsOverText:a.iconsOverText,id:v+"_iladd",onClickButton:function(){A(this,h)||f.jqGrid("addRow",
a.addParams)}});a.edit&&f.jqGrid("navButtonAdd",d,{caption:a.edittext,title:a.edittitle,commonIconClass:a.commonIconClass,buttonicon:a.editicon,iconsOverText:a.iconsOverText,id:v+"_iledit",onClickButton:function(){if(!A(this,h)){var c=b.selrow;c?f.jqGrid("editRow",c,a.editParams):l.modalAlert()}}});a.save&&(f.jqGrid("navButtonAdd",d,{caption:a.savetext,title:a.savetitle,commonIconClass:a.commonIconClass,buttonicon:a.saveicon,iconsOverText:a.iconsOverText,id:v+"_ilsave",onClickButton:function(){if(!A(this,
h)){var d=b.savedRow[0].id;if(d){var e=b.prmNames,g=e.oper,m=a.editParams;c("#"+k.jqID(d),l).hasClass("jqgrid-new-row")?(a.addParams.addRowParams.extraparam[g]=e.addoper,m=a.addParams.addRowParams):(a.editParams.extraparam||(a.editParams.extraparam={}),a.editParams.extraparam[g]=e.editoper);f.jqGrid("saveRow",d,m)}else l.modalAlert()}}}),c(t+"_ilsave").addClass(h));a.cancel&&(f.jqGrid("navButtonAdd",d,{caption:a.canceltext,title:a.canceltitle,commonIconClass:a.commonIconClass,buttonicon:a.cancelicon,
iconsOverText:a.iconsOverText,id:v+"_ilcancel",onClickButton:function(){if(!A(this,h)){var d=b.savedRow[0].id,e=a.editParams;d?(c("#"+k.jqID(d),l).hasClass("jqgrid-new-row")&&(e=a.addParams.addRowParams),f.jqGrid("restoreRow",d,e)):l.modalAlert()}}}),c(t+"_ilcancel").addClass(h));!0===a.restoreAfterSelect&&f.bind("jqGridSelectRow",function(c,d){if(0<b.savedRow.length&&!0===b._inlinenav){var e=b.savedRow[0].id;d!==e&&"number"!==typeof e&&f.jqGrid("restoreRow",e,a.editParams)}});f.bind("jqGridInlineAfterRestoreRow jqGridInlineAfterSaveRow",
function(){f.jqGrid("showAddEditButtons",!1)});f.bind("jqGridInlineEditRow",function(a,b){f.jqGrid("showAddEditButtons",!0,b)})}}})},showAddEditButtons:function(d){return this.each(function(){if(this.grid){var k=this.p,l=k.idSel,f=I.call(this,"disabled"),b=l+"_ilsave,"+l+"_ilcancel"+(k.toppager?","+l+"_top_ilsave,"+l+"_top_ilcancel":""),k=l+"_iladd,"+l+"_iledit"+(k.toppager?","+l+"_top_iladd,"+l+"_top_iledit":"");c(d?k:b).addClass(f);c(d?b:k).removeClass(f)}})}})});
//# sourceMappingURL=grid.inlinedit.map
